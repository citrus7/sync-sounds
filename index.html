<!DOCTYPE html>
<html>
<head>
<!-- Load the Paper.js library -->
<script type="text/javascript" src="js/paper-full.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<!-- Define inlined PaperScript associate it with myCanvas -->
<script type="text/paperscript" canvas="myCanvas">


	
	//key 1
	var cKey = new Path.Rectangle(100,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(52);
	}

	//key 3
	var cKey = new Path.Rectangle(125,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(54);
	}

	//key 5
	var cKey = new Path.Rectangle(150,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(56);
	}
	//key 6
	var cKey = new Path.Rectangle(175,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(57);
	}

	//key 8
	var cKey = new Path.Rectangle(200,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(59);
	}

	//key 10
	var cKey = new Path.Rectangle(225,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(61);
	}

	//key 12
	var cKey = new Path.Rectangle(250,100,25,75);
	cKey.fillColor = 'white';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(63);
	}
	
	//black keys
	//key 2
	var cKey = new Path.Rectangle(112,100,20,35);
	cKey.fillColor = 'black';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(53);
	}
	//key 4
	var cKey = new Path.Rectangle(137,100,20,35);
	cKey.fillColor = 'black';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(55);
	}	
	//key 7
	var cKey = new Path.Rectangle(187,100,20,35);
	cKey.fillColor = 'black';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(58);
	}
	//key 9
	var cKey = new Path.Rectangle(212,100,20,35);
	cKey.fillColor = 'black';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(60);
	}
	//key 11
	var cKey = new Path.Rectangle(237,100,20,35);
	cKey.fillColor = 'black';
	cKey.fullySelected = true;
	cKey.onClick = function(event){
		playNote(62);
	}

	
</script>
<script src="js/timbre.js"></script>
<script>
  var socket = io();

	//key number to frequency
	function keyToFreq(n){
		return Math.pow(2 , (n - 49) / 12) * 440;
	}
	
	var freq = 800;
	
    //play the sound
  function playSound(key) {
    var freq = keyToFreq(key);
    var osc = T("sin", { freq: freq, mul: 0.5 });
    T("timeout", { timeout: 500 }).on("ended", function() {
      this.stop();
    }).set({buddies:osc}).start();
  }

  // play note: send signal to server and play sound
  function playNote(key) {
    socket.emit('sound_key', socket.io.engine.id+ "/" + key);
    playSound(key);
  }

  // play sounds from other players
  socket.on('sound_key', function(msg) {
    var args = msg.split('/');
    var device_id = args[0];
    if (device_id == socket.io.engine.id) return;
    var key = args[1];
    playSound(key);
  });


</script>
</head>
<body>
	<canvas id="myCanvas" resize></canvas>
</body>
</html>